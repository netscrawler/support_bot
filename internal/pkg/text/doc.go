// Package text предоставляет набор функций для использования в Go шаблонах.
//
// Все функции доступны через FuncMap и могут использоваться в text/template и html/template.
// Помимо функций из этого пакета, также доступны все функции из библиотеки Sprig.
package text

/*

ФУНКЦИИ ДЛЯ РАБОТЫ СО СТРОКАМИ
===============================

upper - Преобразует строку в верхний регистр
Вход: "hello world"
Шаблон: {{ upper .text }}
Результат: "HELLO WORLD"

lower - Преобразует строку в нижний регистр
Вход: "HELLO WORLD"
Шаблон: {{ lower .text }}
Результат: "hello world"

trim - Удаляет пробелы в начале и конце строки
Вход: "  hello  "
Шаблон: {{ trim .text }}
Результат: "hello"

contains - Проверяет, содержит ли строка подстроку
Вход: s = "BANK Bank", substr = "BANK"
Шаблон: {{ if contains .bank "BANK" }}Это BANK{{ end }}
Результат: "Это BANK"

hasPrefix - Проверяет, начинается ли строка с префикса
Вход: s = "Итого по банку", prefix = "Итого"
Шаблон: {{ if hasPrefix .text "Итого" }}Это итого{{ end }}
Результат: "Это итого"

hasSuffix - Проверяет, заканчивается ли строка суффиксом
Вход: s = "report.pdf", suffix = ".pdf"
Шаблон: {{ if hasSuffix .filename ".pdf" }}PDF файл{{ end }}
Результат: "PDF файл"

split - Разделяет строку по разделителю
Вход: s = "one,two,three", sep = ","
Шаблон: {{ range split .csv "," }}{{ . }} {{ end }}
Результат: "one two three "

replace - Заменяет все вхождения подстроки
Вход: s = "hello world", old = "world", new = "Go"
Шаблон: {{ replace .text "world" "Go" }}
Результат: "hello Go"

ФУНКЦИИ ДЛЯ ФОРМАТИРОВАНИЯ ЧИСЕЛ
==================================

money - Форматирует число как денежную сумму (простой формат)
Вход: 1234567.89
Шаблон: {{ money .amount }}
Результат: "1234567.89"

formatMoney - Форматирует число как денежную сумму с разделителями тысяч
Вход: 1234567.89
Шаблон: {{ formatMoney .amount }}
Результат: "1 234 567.89"

formatNumber - Форматирует целое число с разделителями тысяч
Вход: 1234567
Шаблон: {{ formatNumber .count }}
Результат: "1 234 567"

percent - Вычисляет процент от общего числа
Вход: part = 25, total = 100
Шаблон: {{ percent .part .total }}%
Результат: "25.00%"

ФУНКЦИИ ДЛЯ РАБОТЫ С ДАТАМИ
=============================

yesterday - Возвращает вчерашнюю дату
Вход: 2026-01-25
Шаблон: {{ yesterday .date }}
Результат: 2026-01-24

lastMonth - Возвращает дату месяц назад
Вход: 2026-01-25
Шаблон: {{ lastMonth .date }}
Результат: 2025-12-25

lastYear - Возвращает дату год назад
Вход: 2026-01-25
Шаблон: {{ lastYear .date }}
Результат: 2025-01-25

addDays - Добавляет дни к дате
Вход: date = 2026-01-25, days = 5
Шаблон: {{ addDays .date 5 }}
Результат: 2026-01-30

subDays - Вычитает дни из даты
Вход: date = 2026-01-25, days = 5
Шаблон: {{ subDays .date 5 }}
Результат: 2026-01-20

diffDays - Возвращает разницу в днях между датами
Вход: a = 2026-01-30, b = 2026-01-25
Шаблон: {{ diffDays .dateA .dateB }} дней
Результат: "5 дней"

addDuration - Добавляет временной интервал к дате
Вход: date = 2026-01-25 10:00, duration = "2h30m"
Шаблон: {{ addDuration .date "2h30m" }}
Результат: 2026-01-25 12:30

startOfDay - Возвращает начало дня (00:00:00)
Вход: 2026-01-25 15:30:45
Шаблон: {{ startOfDay .date }}
Результат: 2026-01-25 00:00:00

startOfMonth - Возвращает первый день месяца
Вход: 2026-01-25
Шаблон: {{ startOfMonth .date }}
Результат: 2026-01-01

endOfMonth - Возвращает последний момент месяца
Вход: 2026-01-25
Шаблон: {{ endOfMonth .date }}
Результат: 2026-01-31 23:59:59

startOfYear - Возвращает первый день года
Вход: 2026-01-25
Шаблон: {{ startOfYear .date }}
Результат: 2026-01-01

endOfYear - Возвращает последний момент года
Вход: 2026-01-25
Шаблон: {{ endOfYear .date }}
Результат: 2026-12-31 23:59:59

ФУНКЦИИ ДЛЯ ФОРМАТИРОВАНИЯ ДАТ
================================

formatRuDate - Форматирует дату на русском языке
Вход: 2026-01-25
Шаблон: {{ formatRuDate .date }}
Результат: "25 января 2026"

formatRuDateTime - Форматирует дату и время на русском языке
Вход: 2026-01-25 15:30
Шаблон: {{ formatRuDateTime .date }}
Результат: "25 января 2026, 15:30"

formatRuMonthYear - Форматирует месяц и год на русском языке
Вход: 2026-01-25
Шаблон: {{ formatRuMonthYear .date }}
Результат: "январь 2026"

formatDateShort - Форматирует дату в кратком формате
Вход: 2026-01-25
Шаблон: {{ formatDateShort .date }}
Результат: "25.01.2026"

formatDateTime - Форматирует дату и время в кратком формате
Вход: 2026-01-25 15:30
Шаблон: {{ formatDateTime .date }}
Результат: "25.01.2026 15:30"

monthRu - Возвращает название месяца на русском (именительный падеж)
Вход: 2026-01-25
Шаблон: {{ monthRu .date }}
Результат: "январь"

monthRuGenitive - Возвращает название месяца на русском (родительный падеж)
Вход: 2026-01-25
Шаблон: {{ monthRuGenitive .date }}
Результат: "января"

monthNameRu - Возвращает название месяца по номеру (именительный падеж)
Вход: 1
Шаблон: {{ monthNameRu 1 }}
Результат: "январь"

monthNameRuGenitive - Возвращает название месяца по номеру (родительный падеж)
Вход: 1
Шаблон: {{ monthNameRuGenitive 1 }}
Результат: "января"

ФУНКЦИИ ДЛЯ РАБОТЫ С MAP
=========================

get - Получает значение из map по ключу
Вход: map = {"key": "value"}
Шаблон: {{ get . "key" }}
Результат: "value"

getOr - Получает значение из map или возвращает значение по умолчанию
Вход: map = {"key": "value"}
Шаблон: {{ getOr . "missing" "default" }}
Результат: "default"

hasKey - Проверяет наличие ключа в map
Вход: map = {"key": "value"}
Шаблон: {{ if hasKey . "key" }}Ключ есть{{ end }}
Результат: "Ключ есть"

keys - Возвращает все ключи из map
Вход: map = {"a": 1, "b": 2}
Шаблон: {{ range keys . }}{{ . }} {{ end }}
Результат: "a b "

values - Возвращает все значения из map
Вход: map = {"a": 1, "b": 2}
Шаблон: {{ range values . }}{{ . }} {{ end }}
Результат: "1 2 "

ФУНКЦИИ ДЛЯ РАБОТЫ С МАССИВАМИ
================================

first - Возвращает первый элемент массива
Вход: [1, 2, 3]
Шаблон: {{ first .array }}
Результат: 1

last - Возвращает последний элемент массива
Вход: [1, 2, 3]
Шаблон: {{ last .array }}
Результат: 3

size - Возвращает размер массива, map или строки
Вход: [1, 2, 3]
Шаблон: {{ size .array }}
Результат: 3

isEmpty - Проверяет, пустой ли массив, map или строка
Вход: []
Шаблон: {{ if isEmpty .array }}Пусто{{ end }}
Результат: "Пусто"

ФУНКЦИИ ДЛЯ РАБОТЫ С JSON
==========================

toJson - Преобразует значение в JSON строку
Вход: {"name": "John", "age": 30}
Шаблон: {{ toJson . }}
Результат: '{"name":"John","age":30}'

parseJson - Парсит JSON строку в значение
Вход: '{"name": "John"}'
Шаблон: {{ $data := parseJson .json }}{{ $data.name }}
Результат: "John"

parseJsonMap - Парсит JSON строку в map
Вход: '{"promo1": 5, "promo2": 10}'
Шаблон: {{ $anyMap := parseJsonMap .json }}{{ range $k, $v := $anyMap }}{{ $k }}: {{ $v }} {{ end }}
Результат: "val: 5 val2: 10 "

УСЛОВНЫЕ ФУНКЦИИ И ПРОВЕРКИ
============================

isZero - Проверяет, является ли значение нулевым
Вход: 0
Шаблон: {{ if isZero .count }}Ноль{{ end }}
Результат: "Ноль"

notEmpty - Проверяет, что строка не пустая и не "null"
Вход: "hello"
Шаблон: {{ if notEmpty .text }}Есть текст{{ end }}
Результат: "Есть текст"

default - Возвращает значение по умолчанию, если значение пустое
Вход: ""
Шаблон: {{ default "No data" .text }}
Результат: "No data"

ternary - Тернарный оператор (условие ? истина : ложь)
Вход: condition = true, trueVal = "Да", falseVal = "Нет"
Шаблон: {{ ternary .condition "Да" "Нет" }}
Результат: "Да"

coalesce - Возвращает первое не-пустое значение
Вход: values = ["", null, "first", "second"]
Шаблон: {{ coalesce "" nil "first" "second" }}
Результат: "first"

ФУНКЦИИ ДЛЯ ЭКРАНИРОВАНИЯ И ФОРМАТИРОВАНИЯ
============================================

escape - Экранирует специальные символы Telegram MarkdownV2
Вход: "Hello_World*Test"
Шаблон: {{ escape .text }}
Результат: "Hello\_World\*Test"

escapeHTML - Экранирует HTML специальные символы
Вход: "<script>alert('XSS')</script>"
Шаблон: {{ escapeHTML .html }}
Результат: "&lt;script&gt;alert('XSS')&lt;/script&gt;"

bold - Оборачивает текст в HTML тег <b>
Вход: "важный текст"
Шаблон: {{ bold "важный текст" }}
Результат: "<b>важный текст</b>"

italic - Оборачивает текст в HTML тег <i>
Вход: "курсив"
Шаблон: {{ italic "курсив" }}
Результат: "<i>курсив</i>"

code - Оборачивает текст в HTML тег <code>
Вход: "console.log()"
Шаблон: {{ code "console.log()" }}
Результат: "<code>console.log()</code>"

safe - Помечает строку как безопасный HTML (не экранируется)
Вход: "<b>Bold</b>"
Шаблон: {{ safe .html }}
Результат: <b>Bold</b> (отрендерится как HTML)

ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ
===========================================

Пример 1: Форматирование денежных сумм
Данные: {"send_amount": 1234567.89, "send_count": 42}
Шаблон:
  Сумма: {{ formatMoney .send_amount }}
  Количество: {{ formatNumber .send_count }}

Результат:
  Сумма: 1 234 567.89
  Количество: 42

Пример 2: Работа с датами
Данные: текущая дата = 2026-01-25
Шаблон:
  {{ $lastMonth := lastMonth now }}
  Отчет за {{ formatRuMonthYear $lastMonth }}

Результат:
  Отчет за декабрь 2025

Пример 3: Упрощенный доступ к map
Данные: {"SomeMap": [{"amount": 1000}]}
Старый способ:
  {{ range index . "SomeMap" }}
    {{ .amount }}
  {{ end }}

Новый способ (все еще используем index, но с упрощениями):
  {{ $stats := index . "SomeMap" }}
  {{ if not (isEmpty $stats) }}
    {{ range $stats }}
      {{ formatMoney .amount }}
    {{ end }}
  {{ end }}

Пример 4: Работа с JSON
Данные: {"some_json": '{"some_key_one": 5, "some_key_two": 10}'}
Старый способ:
  {{- if and . (ne . "null") -}}
    {{- $some_map := fromJson . -}}
    {{- range $k, $v := $some_map -}}
      {{ $k }}: {{ $v }}
    {{- end -}}
  {{- end -}}

Новый способ:
  {{ $some_map := parseJsonMap .some_json }}
  {{ if notEmpty .some_json }}
    {{ range $k, $v := $some_map }}
      {{ $k }}: {{ $v }}
    {{ end }}
  {{ end }}

Пример 5: Условное форматирование
Данные: {"bank": "BANK Bank", "amount": 1000}
Шаблон:
  {{ if contains .bank "BANK" }}
    Банк BANK: {{ formatMoney .amount }}
  {{ else }}
    Другой банк: {{ formatMoney .amount }}
  {{ end }}

Результат:
  Банк BANK: 1 000.00

Пример 6: Значения по умолчанию
Данные: {"description": ""}
Шаблон:
  Описание: {{ default "Нет описания" .description }}

Результат:
  Описание: Нет описания

Пример 7: Проверка на пустоту и форматирование
Данные: {"items": [1, 2, 3], "total": 0}
Шаблон:
  {{ if not (isEmpty .items) }}
    Количество элементов: {{ size .items }}
  {{ end }}
  {{ if isZero .total }}
    Итого: данные отсутствуют
  {{ else }}
    Итого: {{ formatMoney .total }}
  {{ end }}

Результат:
  Количество элементов: 3
  Итого: данные отсутствуют
*/
