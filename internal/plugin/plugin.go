package plugins

import (
	"context"
)

// Plugin определяет интерфейс, который должны реализовывать все Lua-плагины.
// Этот интерфейс обеспечивает единообразный способ работы с плагинами независимо
// от их внутренней реализации.
type Plugin interface {
	// Методы получения метаданных плагина

	// Name возвращает уникальное имя плагина
	Name() string

	// Version возвращает версию плагина в формате semver (например, "1.0.0")
	Version() string

	// Description возвращает человекочитаемое описание функциональности плагина
	Description() string

	// Методы жизненного цикла плагина

	// Init инициализирует плагин с заданной конфигурацией.
	// Вызывается один раз при загрузке плагина.
	// config - карта с параметрами конфигурации из YAML
	Init(config map[string]any) error

	// Execute запрашивает данные из внешнего источника.
	// Это основная рабочая функция плагина.
	// ctx - контекст для отмены операции или установки таймаута
	// params - параметры запроса (например, URL, фильтры и т.д.)
	// Возвращает данные в формате JSON
	Execute(ctx context.Context, params map[string]any) ([]byte, error)

	// Validate проверяет корректность параметров перед выполнением запроса.
	// Позволяет отловить ошибки до начала выполнения Execute
	Validate(params map[string]any) error

	// Cleanup освобождает ресурсы плагина при выгрузке.
	// Вызывается при остановке приложения или перезагрузке плагина
	Cleanup() error

	// Методы управления состоянием и мониторинга

	// IsHealthy возвращает true если плагин работает корректно.
	// Используется для health checks и мониторинга
	IsHealthy() bool
}

// PluginInfo содержит базовую информацию о плагине.
// Используется для отображения списка плагинов и их состояния.
type PluginInfo struct {
	// Name - имя плагина
	Name string

	// Version - версия плагина
	Version string

	// Description - описание плагина
	Description string

	// Author - автор плагина
	Author string

	// FilePath - путь к файлу плагина на диске
	FilePath string

	// Healthy - флаг работоспособности плагина
	Healthy bool
}
